<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario SATH (Versi√≥n Final)</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 1em;
        }
        .container {
            width: 800px;
            margin: auto;
            background: #fff;
            padding: 2em;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .button {
            display: inline-block; padding: 12px 22px; font-size: 1em; font-weight: bold;
            color: white; background-color: #0d6efd; border: none; border-radius: 5px; cursor: pointer; margin-top: 1em;
        }
        .button.secondary { background-color: #6c757d; margin-left: 10px;}
        .button.print { background-color: #198754; }
        .button.desktop-mode {
            display: none;
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 1000;
            background-color: #ffc107;
            color: black;
        }

        /* VISTA 1: FORMULARIO */
        #form-view h1 { font-size: 1.8em; }
        #form-view p { text-align: center; color: #333; }
        #form-view .form-group { margin-bottom: 1em; }
        #form-view label { display: block; margin-bottom: 5px; font-weight: 600; }
        #form-view input[type="text"] {
            width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 1em;
        }
        
        /* VISTA 2: PREVISUALIZACI√ìN */
        #preview-container { display: none; width: 100%; text-align: center; }
        #a4-wrapper {
            position: relative; width: 210mm; height: 297mm; margin: auto;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            overflow: hidden;
            background-color: white;
        }
        #a4-wrapper img { width: 100%; height: 100%; }
        .overlay-text {
            position: absolute;
            white-space: nowrap; overflow: hidden;
            padding: 2px;
        }
        
        /* --- ESTILOS DE TU PLANTILLA --- */
        #p_1 { top: 17.63%; left: 56.80%; width: 15.74%; height: 3.03%; font-family: "Arial Black", sans-serif; font-size: 15px; color: rgb(0, 0, 0); font-weight: normal; text-align: center; }
        #p_2 { top: 17.72%; left: 73.42%; width: 15.74%; height: 3.03%; font-family: "Arial Black", sans-serif; font-size: 15px; color: rgb(0, 0, 0); font-weight: 400; text-align: center; }
        #p_3 { top: 27.87%; left: 28.21%; width: 15.74%; height: 3.03%; font-family: Helvetica, sans-serif; font-size: 14px; color: rgb(0, 0, 0); font-weight: 400; text-align: center; }
        #p_custom_1 { top: 27.69%; left: 8.56%; width: 20.27%; height: 2.40%; font-family: Arial, sans-serif; font-size: 14px; color: rgb(0, 0, 0); font-weight: 400; text-align: center; }
        #p_custom_2 { top: 24.75%; left: 18.76%; width: 20.65%; height: 3.47%; font-family: Arial, sans-serif; font-size: 14px; color: rgb(0, 0, 0); font-weight: 400; text-align: center; }
        #p_custom_3 { top: 28.05%; left: 45.84%; width: 39.67%; height: 1.78%; font-family: Verdana, sans-serif; font-size: 13px; color: rgb(0, 0, 0); font-weight: normal; text-align: center; }
        #p_custom_5 { top: 24.93%; left: 45.34%; width: 42.44%; height: 2.13%; font-family: Verdana, sans-serif; font-size: 13px; color: rgb(0, 0, 0); font-weight: 400; text-align: center; }
        #p_custom_6 { top: 31.25%; left: 15.36%; width: 60.07%; height: 2.04%; font-family: Verdana, sans-serif; font-size: 13px; color: rgb(0, 0, 0); font-weight: 400; text-align: center; }
        #p_custom_7 { top: 44.70%; left: 24.05%; width: 12.72%; height: 2.22%; font-family: "Arial Black", sans-serif; font-size: 13px; color: rgb(0, 0, 0); font-weight: 700; text-align: center; }
        #p_custom_8 { top: 44.88%; left: 42.57%; width: 13.85%; height: 2.22%; font-family: "Arial Black", sans-serif; font-size: 13px; color: rgb(0, 0, 0); font-weight: 700; text-align: center; }
        #p_custom_10 { top: 6.41%; left: 64.73%; width: 3.65%; height: 2.76%; font-family: Arial, sans-serif; font-size: 14px; color: rgb(0, 0, 0); font-weight: 400; text-align: center; }
        #p_custom_11 { top: 6.32%; left: 70.15%; width: 9.32%; height: 2.76%; font-family: Arial, sans-serif; font-size: 14px; color: rgb(0, 0, 0); font-weight: 400; text-align: center; }

        @media (max-width: 850px) {
            .button.desktop-mode { display: inline-block; }
            body { padding: 0.5em; }
            .container { width: 100%; padding: 1.5em; box-sizing: border-box; }
            #a4-wrapper { width: 100%; height: auto; aspect-ratio: 210 / 297; margin: 0; }
            .button-group { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
            .button.secondary { margin-left: 0; }
        }
        .force-desktop-view { width: 850px !important; overflow-x: auto; }

        @media print {
            @page { size: A4 portrait; margin: 0; }
            body, html { margin: 0 !important; padding: 0 !important; width: 210mm; height: 297mm; }
            #form-view, .button-group, .button.desktop-mode { display: none !important; }
            #preview-container { display: block !important; position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
            #a4-wrapper { box-shadow: none; width: 100%; height: 100%; }
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
    </style>
</head>
<body>

    <div id="form-view" class="container">
        <h1>Formulario de Datos</h1>
        <p>Rellena la informaci√≥n para generar el documento.</p>
        <div id="dynamic-form-container"></div>
        <div style="text-align:center;">
            <button class="button" onclick="showPreview()">Previsualizar Documento</button>
        </div>
    </div>

    <div id="preview-container">
        <div id="a4-wrapper">
            <img src="1000016230.jpg" alt="Fondo del formulario">
        </div>
        <div class="button-group" style="margin-top:15px;">
             <button class="button print" onclick="window.print()">Generar PDF</button>
             <button class="button secondary" onclick="backToForm()">Volver al Formulario</button>
        </div>
    </div>
    
    <button id="desktop-mode-btn" class="button desktop-mode" onclick="toggleDesktopMode()">Ver Modo Escritorio üñ•Ô∏è</button>

    <script>
        const templateFields = [
            { id: 'p_1', label: 'PAPELETA NRO.' }, { id: 'p_2', label: 'FECHA' },
            { id: 'p_3', label: 'TELEFONO MOVIL' }, { id: 'p_custom_1', label: 'TEL√âFONO FIJO' },
            { id: 'p_custom_2', label: 'DNI' }, { id: 'p_custom_3', label: 'CORREO ELECTR√ìNICO' },
            { id: 'p_custom_5', label: 'APELLIDOS Y NOMBRES' }, { id: 'p_custom_6', label: 'DIRECCI√ìN' },
            { id: 'p_custom_7', label: 'PAPELETA NRO.' }, { id: 'p_custom_8', label: 'FECHA' },
            { id: 'p_custom_10', label: 'FECHA D√çA' }, { id: 'p_custom_11', label: 'FECHA MES' },
        ];
        
        const wrapper = document.getElementById('a4-wrapper');

        function createForm() {
            const formContainer = document.getElementById('dynamic-form-container');
            formContainer.innerHTML = '';
            templateFields.forEach(field => {
                const group = document.createElement('div');
                group.className = 'form-group';
                const label = document.createElement('label');
                label.htmlFor = `f_${field.id}`;
                label.innerText = field.label;
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `f_${field.id}`;
                input.dataset.targetId = field.id;
                group.appendChild(label);
                group.appendChild(input);
                formContainer.appendChild(group);

                // --- L√ìGICA DE AUTOCOMPLETADO Y FORMATO ---
                if (field.label === 'FECHA') {
                    input.addEventListener('input', formatAndSyncDate);
                }
                if (field.label === 'PAPELETA NRO.') {
                    input.addEventListener('input', syncField);
                }
            });
        }

        function syncField(e) {
            const sourceId = e.target.id;
            const sourceLabel = document.querySelector(`label[for="${sourceId}"]`).innerText;
            const value = e.target.value;
            const allInputs = document.querySelectorAll('#dynamic-form-container input');
            
            allInputs.forEach(input => {
                const labelText = document.querySelector(`label[for="${input.id}"]`).innerText;
                if (input.id !== sourceId && labelText === sourceLabel) {
                    input.value = value;
                }
            });
        }

        function formatAndSyncDate(e) {
            let value = e.target.value.replace(/\D/g, ''); // Eliminar no n√∫meros
            if (value.length > 2) value = value.slice(0, 2) + '.' + value.slice(2);
            if (value.length > 5) value = value.slice(0, 5) + '.' + value.slice(5);
            if (value.length > 10) value = value.slice(0, 10);
            e.target.value = value;
            syncField(e); // Sincronizar el valor ya formateado
        }

        function capitalize(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
        }

        function showPreview() {
            wrapper.innerHTML = '<img src="1000016230.jpg" alt="Fondo del formulario">';
            const inputs = document.querySelectorAll('#dynamic-form-container input');
            
            inputs.forEach(input => {
                const targetId = input.dataset.targetId;
                const fieldDiv = document.createElement('div');
                fieldDiv.id = targetId;
                fieldDiv.className = 'overlay-text';
                if (targetId === 'p_custom_11') {
                    fieldDiv.innerText = capitalize(input.value);
                } else {
                    fieldDiv.innerText = input.value.toUpperCase();
                }
                wrapper.appendChild(fieldDiv);
            });
            document.getElementById('form-view').style.display = 'none';
            document.getElementById('preview-container').style.display = 'block';
        }

        function backToForm() {
            document.getElementById('preview-container').style.display = 'none';
            document.getElementById('form-view').style.display = 'block';
        }

        function toggleDesktopMode() {
            const viewportMeta = document.querySelector('meta[name="viewport"]');
            const button = document.getElementById('desktop-mode-btn');
            if (document.body.classList.contains('force-desktop-view')) {
                document.body.classList.remove('force-desktop-view');
                viewportMeta.setAttribute('content', 'width=device-width, initial-scale=1.0');
                button.innerHTML = 'Ver Modo Escritorio üñ•Ô∏è';
            } else {
                document.body.classList.add('force-desktop-view');
                viewportMeta.setAttribute('content', 'width=850');
                button.innerHTML = 'Ver Modo Celular üì±';
            }
        }
        window.onload = createForm;
    </script>
</body>
</html>